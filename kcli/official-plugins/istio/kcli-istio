#!/usr/bin/env bash
set -euo pipefail

usage() {
  cat <<'USAGE'
kcli-istio - Istio service mesh commands

Usage:
  kcli istio proxy-status
  kcli istio virtualservices [namespace]
  kcli istio destinationrules [namespace]
USAGE
}

cmd="${1:-}"
case "$cmd" in
  proxy-status)
    kubectl get pods -A -l app=istiod
    ;;
  virtualservices)
    ns="${2:-}"
    if [[ -n "$ns" ]]; then
      kubectl get virtualservices.networking.istio.io -n "$ns"
    else
      kubectl get virtualservices.networking.istio.io -A
    fi
    ;;
  destinationrules)
    ns="${2:-}"
    if [[ -n "$ns" ]]; then
      kubectl get destinationrules.networking.istio.io -n "$ns"
    else
      kubectl get destinationrules.networking.istio.io -A
    fi
    ;;
  *)
    usage
    ;;
esac
