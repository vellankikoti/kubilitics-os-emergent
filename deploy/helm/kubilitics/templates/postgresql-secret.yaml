{{- if and (eq .Values.database.type "postgresql") .Values.postgresql.enabled }}
{{- $host := .Values.database.postgresql.host | default (printf "%s-postgresql" (include "kubilitics.fullname" .)) }}
{{- $port := .Values.database.postgresql.port | default 5432 }}
{{- $database := .Values.database.postgresql.database | default .Values.postgresql.auth.database }}
{{- $username := .Values.database.postgresql.username | default .Values.postgresql.auth.username }}
{{- $postgresqlSecretName := printf "%s-postgresql" (include "kubilitics.fullname" .) }}
{{- $sslMode := .Values.database.postgresql.sslMode | default "require" }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "kubilitics.postgresqlSecretName" . }}
  labels:
    {{- include "kubilitics.labels" . | nindent 4 }}
type: Opaque
stringData:
  postgresql-host: {{ $host }}
  postgresql-port: {{ $port | toString }}
  postgresql-database: {{ $database }}
  postgresql-username: {{ $username }}
  postgresql-ssl-mode: {{ $sslMode }}
  # Note: Password is stored in Bitnami PostgreSQL secret: {{ $postgresqlSecretName }}
  # Connection string format: postgresql://username:password@host:port/database?sslmode=mode
{{- end }}
